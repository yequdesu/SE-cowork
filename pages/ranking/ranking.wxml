<view class="container">
  
  <!-- ã€æ–°å¢ã€‘å¼•å…¥ WXS ç”¨äºè®¡ç®—æ¯”ä¾‹ -->
  <wxs module="utils">
    module.exports.calcHeight = function(score, maxScore) {
      if (!maxScore || maxScore == 0) return '0%';
      // è®¡ç®—ç™¾åˆ†æ¯”ï¼Œæœ€ä½ç»™ 5% é«˜åº¦ä»¥å…å¤ªçŸ­çœ‹ä¸è§
      var percent = (score / maxScore) * 100;
      return (percent < 5 ? 5 : percent) + '%';
    }
  </wxs>
  
  <!-- é¡¶éƒ¨æ  -->
  <view class="header fade-in">
    <view class="header-left">
      <text class="page-title">ç§¯åˆ†æ¦œ</text>
      <text class="page-subtitle">ä»Šå¤©ä½ æ‹¿åˆ†äº†å—</text>
    </view>
    <view class="header-buttons">
      <view class="btn-export" bindtap="exportScores" hover-class="btn-hover">
        <text class="icon-export {{exporting ? 'spinning' : ''}}">ğŸ“Š</text>
      </view>
      <view class="btn-refresh" bindtap="refreshData" hover-class="btn-hover">
        <text class="icon-refresh {{loading ? 'spinning' : ''}}">â†»</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-state fade-in">
    <view class="spinner-ring"></view>
    <text>æ­£åœ¨åŒæ­¥æœ€æ–°æˆ˜å†µ...</text>
  </view>

  <view wx:else class="content-body">
    
    <!-- 1. é¢†å¥–å°åŒºåŸŸ (Top 3) -->
    <view class="podium-section slide-up" wx:if="{{rankings.length >= 3}}" style="animation-delay: 0.1s;">
      <!-- äºšå†› (Rank 2) -->
      <view class="podium-item rank-2">
        <view class="avatar-wrapper ring-silver">
          <text class="badge-rank">2</text>
          <view class="avatar">{{rankings[1].name[0]}}</view>
        </view>
        <text class="name">{{rankings[1].name}}</text>
        <text class="score">{{rankings[1].score}}</text>
      </view>
      
      <!-- å† å†› (Rank 1) -->
      <view class="podium-item rank-1">
        <view class="crown-icon">ğŸ‘‘</view>
        <view class="avatar-wrapper ring-gold">
          <text class="badge-rank">1</text>
          <view class="avatar large">{{rankings[0].name[0]}}</view>
          <!-- å…‰æ•ˆè£…é¥° -->
          <view class="shine-effect"></view>
        </view>
        <text class="name main-name">{{rankings[0].name}}</text>
        <text class="score main-score">{{rankings[0].score}}</text>
      </view>
      
      <!-- å­£å†› (Rank 3) -->
      <view class="podium-item rank-3">
        <view class="avatar-wrapper ring-bronze">
          <text class="badge-rank">3</text>
          <view class="avatar">{{rankings[2].name[0]}}</view>
        </view>
        <text class="name">{{rankings[2].name}}</text>
        <text class="score">{{rankings[2].score}}</text>
      </view>
    </view>

    <!-- 2. è¶‹åŠ¿åˆ†æ (å›¾è¡¨) -->
    <view class="section-card slide-up" style="animation-delay: 0.2s;">
      <view class="card-header">
        <text class="section-title">ç§¯åˆ†è¶‹åŠ¿</text>
        <text class="section-tag">Top 10</text>
      </view>
      <scroll-view scroll-x class="chart-scroll" enable-flex>
        <view class="chart-container">
          <!-- è¿™é‡Œå‡è®¾ rankings æ˜¯æŒ‰åˆ†æ•°æ’åºçš„ï¼Œæ‰€ä»¥ rankings[0] æ˜¯æœ€é«˜åˆ† -->
          <view wx:for="{{rankings}}" wx:key="studentId" class="bar-group">
            <text class="bar-value">{{item.score}}</text>
            <!-- è¿›åº¦æ¡å®¹å™¨ -->
            <view class="bar-track">
              <!-- ã€ä¿®å¤ã€‘ä½¿ç”¨ WXS åŠ¨æ€è®¡ç®—é«˜åº¦ç™¾åˆ†æ¯” -->
              <view 
                class="bar-fill {{index < 3 ? 'fill-hot' : 'fill-cool'}}" 
                style="height: {{utils.calcHeight(item.score, rankings[0].score)}};" 
              ></view>
            </view>
            <text class="bar-label">{{item.name}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 3. è¯¦ç»†åå•åˆ—è¡¨ -->
    <view class="list-section slide-up" style="animation-delay: 0.3s;">
      <view class="list-header">
        <text>åæ¬¡</text>
        <text class="align-left">å­¦å‘˜ä¿¡æ¯</text>
        <text class="align-right">ç§¯åˆ†</text>
      </view>

      <view wx:for="{{rankings}}" wx:key="studentId" class="rank-row" hover-class="row-hover">
        <!-- æ’å -->
        <view class="col-rank">
          <!-- ã€ä¿®å¤ã€‘ç»Ÿä¸€æ’åçš„æ ·å¼ç±» -->
          <view class="rank-num {{index < 3 ? 'top-rank rank-' + (index+1) : 'normal-rank'}}">
            {{index + 1}}
          </view>
        </view>
        
        <!-- ä¿¡æ¯ -->
        <view class="col-info">
          <view class="row-avatar">{{item.name[0]}}</view>
          <view class="info-text">
            <text class="student-name">{{item.name}}</text>
            <text class="student-count">ç‚¹å {{item.rollCallCount}} æ¬¡</text>
          </view>
        </view>
        
        <!-- åˆ†æ•° -->
        <view class="col-score">
          <text class="score-num">{{item.score}}</text>
        </view>
      </view>
    </view>

  </view>
</view>