<view class="container">
  
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="header fade-in">
    <view class="header-text">
      <text class="title">è¯¾å ‚ç‚¹å</text>
      <text class="subtitle">éšæœºæŠ½å– â€¢ å…¬å¹³è®°å½•</text>
    </view>

    <!-- å³ä¾§æ§åˆ¶åŒº -->
    <view class="header-controls">
      <!-- æ¨¡å¼åˆ‡æ¢ -->
      <view class="segment-control">
        <view
          class="segment-item {{selectedMode === 'random' ? 'active' : ''}}"
          bindtap="selectMode"
          data-mode="random"
        >éšæœº</view>
        <view
          class="segment-item {{selectedMode === 'sequential' ? 'active' : ''}}"
          bindtap="selectMode"
          data-mode="sequential"
        >é¡ºåº</view>
      </view>

      <!-- éšæœºäº‹ä»¶æŒ‰é’® (æ ·å¼å·²ç»Ÿä¸€) -->
      <button class="btn-events" bindtap="goToEvents" hover-class="btn-hover">
        <text class="btn-events-icon">ğŸ²</text>
        <text>éšæœºäº‹ä»¶</text>
      </button>
    </view>
  </view>

  <!-- æ ¸å¿ƒå±•ç¤ºåŒºï¼šæŠ½å¥–å¡ç‰Œ -->
  <view class="hero-section slide-up" style="animation-delay: 0.1s;">
    <view class="student-card {{currentStudent.name ? 'has-data' : 'is-empty'}}">
      
      <!-- èƒŒæ™¯è£…é¥°å…‰æ–‘ -->
      <view class="bg-blob blob-1"></view>
      <view class="bg-blob blob-2"></view>

      <!-- çŠ¶æ€ A: å¾…æœºä¸­ -->
      <view wx:if="{{!currentStudent.name}}" class="state-empty">
        <view class="empty-icon-wrapper">
          <text class="icon-dice">ğŸ²</text>
        </view>
        <text class="empty-hint">ç‚¹å‡»æŒ‰é’®å¼€å§‹æŠ½å–</text>
      </view>

      <!-- çŠ¶æ€ B: é€‰ä¸­ç»“æœ -->
      <view wx:else class="state-result">
        <view class="avatar-ring">
          <view class="avatar">{{currentStudent.name[0]}}</view>
        </view>
        
        <text class="result-name">{{currentStudent.name}}</text>
        <text class="result-id">{{currentStudent.student_id}}</text>
        
        <!-- è¿å‡»æ˜¾ç¤º -->
        <view wx:if="{{combo > 1}}" class="combo-display">
          <text class="combo-text">ğŸ”¥ Combo x{{combo}}</text>
        </view>

        <!-- éšæœºäº‹ä»¶å¡ç‰‡ -->
        <view wx:if="{{randomEventInfo}}" class="event-display">
          <view class="event-content">
            <view class="event-header">
              <text class="event-icon">{{randomEventInfo.icon}}</text>
              <text class="event-name">{{randomEventInfo.name}}</text>
              <text wx:if="{{randomEventInfo.bonusScore > 0}}" class="event-bonus">+{{randomEventInfo.bonusScore}}</text>
            </view>
            <text class="event-description">{{randomEventInfo.description}}</text>
          </view>
        </view>

        <view class="shine-effect"></view>
      </view>
    </view>
  </view>

  <!-- æ ¸å¿ƒæ“ä½œæŒ‰é’® -->
  <view class="action-section slide-up" style="animation-delay: 0.2s;">
    <button 
      class="btn-main" 
      hover-class="btn-main-hover" 
      bindtap="performRollCall"
    >
      <text class="btn-icon">âš¡ï¸</text>
      <text>å¼€å§‹ç‚¹å</text>
      <view class="btn-glare"></view>
    </button>
  </view>

  <!-- è¯„ä»·è¡¨å• (é€‰äººåä¸Šæµ®æ˜¾ç¤º) -->
  <view class="evaluation-panel {{currentStudent.name ? 'is-visible' : ''}} slide-up" style="animation-delay: 0.3s;">
    <view class="panel-header">
      <text class="panel-title">è¯¾å ‚è¡¨ç°è®°å½•</text>
    </view>
    
    <view class="panel-body">
      
      <!-- ç¬¬ä¸€è¡Œï¼šè€ƒå‹¤çŠ¶æ€ -->
      <view class="control-row">
        <view
          class="tag-toggle {{arrived ? 'active-green' : ''}}"
          bindtap="toggleArrived"
          hover-class="chip-hover"
        >
          <view class="toggle-icon">{{arrived ? 'âœ“' : 'â—‹'}}</view>
          <text>å·²åˆ°è¾¾è¯¾å ‚</text>
        </view>
      </view>

      <!-- ç¬¬äºŒè¡Œï¼šå¤è¿°æƒ…å†µ (å•é€‰) -->
      <view wx:if="{{arrived}}" class="control-row fade-in">
        <text class="row-label">å¤è¿°é—®é¢˜</text>
        <view class="radio-group">
          <!-- ã€ä¿®å¤ã€‘data-value ä½¿ç”¨ {{}} ä¼ é€’å¸ƒå°”å€¼ -->
          <view
            class="radio-chip {{recitationCorrect === true ? 'active-green' : ''}}"
            bindtap="setRecitationCorrect"
            data-value="{{true}}"
            hover-class="chip-hover"
          >
            <text class="radio-icon">{{recitationCorrect === true ? 'âœ“' : ''}}</text>
            <text>å›ç­”æ­£ç¡®</text>
          </view>
          
          <view
            class="radio-chip {{recitationCorrect === false ? 'active-red' : ''}}"
            bindtap="setRecitationCorrect"
            data-value="{{false}}"
            hover-class="chip-hover"
          >
            <text class="radio-icon">{{recitationCorrect === false ? 'âœ•' : ''}}</text>
            <text>å›ç­”é”™è¯¯</text>
          </view>
        </view>
        
        <!-- å…æ‰£åˆ†äº‹ä»¶æç¤º -->
        <view wx:if="{{recitationCorrect === false && randomEventInfo.name === 'å…æ‰£åˆ†'}}" class="exemption-notice fade-in">
          <text>ğŸ›¡ï¸ è§¦å‘å…æ‰£åˆ†ä¿æŠ¤ï¼Œæœ¬æ¬¡ä¸æ‰£åˆ†</text>
        </view>
      </view>

      <!-- ç¬¬ä¸‰è¡Œï¼šåˆ†æ•°è¾“å…¥ -->
      <view wx:if="{{arrived}}" class="control-row score-row fade-in">
        <text class="row-label">è¯„åˆ† (0.5 - 3.0)</text>
        <view class="input-wrapper">
          <input
            class="score-input"
            placeholder="0.0"
            value="{{answerScore}}"
            bindinput="onAnswerScoreInput"
            type="digit"
            confirm-type="done"
          />
          <text class="unit">åˆ†</text>
          
          <!-- åŠ¨æ€åˆ†æ•°æ ‡ç­¾ -->
          <view wx:if="{{recitationCorrect === true && totalMultiplier > 1}}" class="modifier-tag multiplier">
            <text>Ã—{{totalMultiplier}}</text>
          </view>
          <view wx:if="{{recitationCorrect === true && bonusScore > 0}}" class="modifier-tag bonus">
            <text>+{{bonusScore}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨ï¼šé¢„è§ˆä¸æäº¤ -->
    <view class="panel-footer">
      <view wx:if="{{arrived}}" class="preview-bar">
        <text class="preview-label">é¢„è®¡ç§¯åˆ†</text>
        <text class="preview-val">{{previewScore || '0.0'}}</text>
      </view>

      <!-- ã€ä¿®å¤ã€‘æœªåˆ°è¾¾æ—¶ç¦ç”¨æŒ‰é’® -->
      <button 
        class="btn-submit {{!arrived ? 'disabled' : ''}}" 
        hover-class="btn-sub-hover" 
        bindtap="submitUpdate"
        disabled="{{!arrived}}"
      >
        ç¡®è®¤è®°å½•
      </button>
    </view>
  </view>

</view>